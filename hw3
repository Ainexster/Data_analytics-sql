Select 'ФИО: Федотенкова Полина Сергеевна';

-- Оконные функции
select
	userid, movieid,
	-- normed_rating=(r - r_min)/(r_max - r_min)
	(rating - MIN(rating) OVER (PARTITION BY userId))/((MAX(rating) OVER (PARTITION BY userId)) - MIN(rating) OVER (PARTITION BY userId)) as normed_rating,
	AVG(rating) OVER (PARTITION BY userId) as avg_rating
from ratings
limit 30;

Результат:

<pre>

userid | movieid |   normed_rating   |    avg_rating
--------+---------+-------------------+------------------
      1 |     110 | 0.111111111111111 | 4.27777777777778
      1 |     147 | 0.888888888888889 | 4.27777777777778
      1 |    1221 |                 1 | 4.27777777777778
      1 |    2918 |                 1 | 4.27777777777778
      1 |   59315 |                 1 | 4.27777777777778
      1 |   68358 |                 1 | 4.27777777777778
      1 |    2959 | 0.777777777777778 | 4.27777777777778
      1 |   69844 |                 1 | 4.27777777777778
      1 |   73017 |                 1 | 4.27777777777778
      1 |    1246 |                 1 | 4.27777777777778
      1 |    4226 | 0.777777777777778 | 4.27777777777778
      1 |   81834 |                 1 | 4.27777777777778
      1 |   91500 | 0.444444444444444 | 4.27777777777778
      1 |    4878 |                 1 | 4.27777777777778
      1 |   91542 |                 1 | 4.27777777777778
      1 |   92439 |                 1 | 4.27777777777778
      1 |     858 |                 1 | 4.27777777777778
      1 |    1968 | 0.777777777777778 | 4.27777777777778
      1 |    5577 |                 1 | 4.27777777777778
      1 |   96821 |                 1 | 4.27777777777778
      1 |   98809 |                 0 | 4.27777777777778
      1 |   33794 | 0.777777777777778 | 4.27777777777778
      1 |   99114 | 0.777777777777778 | 4.27777777777778
      1 |  112552 |                 1 | 4.27777777777778
      1 |    2762 | 0.888888888888889 | 4.27777777777778
      1 |   54503 | 0.666666666666667 | 4.27777777777778
      1 |   58559 | 0.777777777777778 | 4.27777777777778
      2 |      64 |              0.75 | 3.31818181818182
      2 |      79 |              0.75 | 3.31818181818182
      2 |     141 |               0.5 | 3.31818181818182
(30 rows)

</pre>





